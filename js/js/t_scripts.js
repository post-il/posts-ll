function isElementInViewPort(t){if($(t).length){var e=$(t).offset().top,n=($(t).outerHeight(),$(t).offset().left);return e<$(window).scrollTop()+$(window).height()&&n>=0}}function addDashesToUuid(t){return t+="",t.includes("-")?t:t.substr(0,8)+"-"+t.substr(8,4)+"-"+t.substr(12,4)+"-"+t.substr(16,4)+"-"+t.substr(20)}function getProductFirstCategoryName(t){return!t||!t.categories||t.categories.length<=0?null:t.categories[0].name}function getOrderShipping(t){if(t.payment&&t.payment.invoice&&t.payment.invoice.length>0){var e=t.payment.invoice.filter(function(t){return"shipping"===t.code});if(e&&e.length>0)return e[0].value}return null}function getOrderVat(t){if(t.payment&&t.payment.invoice&&t.payment.invoice.length>0){var e=t.payment.invoice.filter(function(t){return"vat"===t.code});if(e&&e.length>0)return e[0].value}return null}function getOrderItems(t,e){var n=[],r=null;if(t&&t.products&&t.products.length>0){if(t.payment&&t.payment.invoice){t.payment.invoice.forEach(function(t){"total"===t.code&&(r=t.value)})}n=t.products.map(function(n){return{id:t.id,order_total:r,product_id:addDashesToUuid(n.id),name:n.name,sku:n.sku,category:getProductFirstCategoryName(n),price:n.price,quantity:n.quantity,currency:e,total:n.total}})}return n}function getOrderItemsForAppMarketEvents(t,e){var n=[],r=null;if(t&&t.products&&t.products.length>0){if(t.payment&&t.payment.invoice){t.payment.invoice.forEach(function(t){"total"===t.code&&(r=t.value)})}n=t.products.map(function(n){return{id:t.id,order:{total:r},product_id:addDashesToUuid(n.id),name:n.name,sku:n.sku,category:getProductFirstCategoryName(n),price:n.price,quantity:n.quantity,currency:e,total:n.total}})}return n}function getOrderProductsIds(t){var e=[];return t&&t.products&&t.products.length>0&&(e=t.products.map(function(t){return addDashesToUuid(t.id)})),e}function getOrderCoupon(t){return t.coupon&&t.coupon.code?t.coupon.code:null}function getSubTotalWithoutVAT(t){if(t.payment&&t.payment.invoice&&t.payment.invoice.length>0){var e=t.payment.invoice.filter(function(t){return"sub_totals_before_vat"===t.code});if(e&&e.length<=0&&(e=t.payment.invoice.filter(function(t){return"sub_totals"===t.code})),e&&e.length>0)return e[0].value}return 0}function sendPurchaseTrackingEvent(t,e,n){try{var r={id:t.id,affiliation:null,revenue:t.order_total,shipping:getOrderShipping(t),tax:getOrderVat(t),currency:n,coupon:getOrderCoupon(t)},o=getOrderItems(t,n),i=getOrderItemsForAppMarketEvents(t,n);if("function"==typeof window.ga){if(o&&o.length>0)for(var c=0;c<o.length;c++)window.ga("ec:addProduct",o[c]),"undefined"!=typeof merchantGA&&window.ga("merchantTracker.ec:addProduct",o[c]);window.ga("ec:setAction","purchase",r),window.ga("send","event","Purchase",""+t.id),"undefined"!=typeof merchantGA&&(window.ga("merchantTracker.ec:setAction","purchase",r),window.ga("merchantTracker.send","event","Purchase",""+t.id))}if("function"==typeof window.snaptr&&window.snaptr("track","PURCHASE",{client_deduplication_id:t.id,transaction_id:t.id,item_ids:getOrderProductsIds(t),price:"string"==typeof t.order_total?parseFloat(t.order_total):t.order_total,currency:n}),"function"==typeof window.fbq&&window.fbq("track","Purchase",{value:"string"==typeof t.order_total?parseFloat(t.order_total):t.order_total,currency:n,content_type:"product",contents:o.map(function(t){return t.id=t.product_id,t})},{eventID:t.id}),window.PostAffTracker&&"function"==typeof window.PostAffTracker.register&&o&&o.length>0){for(var a="",c=0;c<o.length;c++)a=a+o[c].product_id+";";var u=window.PostAffTracker.createSale();u.setTotalCost(""+getSubTotalWithoutVAT(t)),u.setProductID(a),u.setOrderID(""+r.id),window.PostAffTracker.register()}window.dataLayer&&(window.dataLayer.push({ecommerce:null}),window.dataLayer.push({event:"purchase",ecommerce:{purchase:{actionField:r,products:o.map(function(t){return t.id=t.product_id,t})}},customer:window.customerHashed})),"function"==typeof window.gtag&&window.gtag("event","purchase",{transaction_id:r.id,affiliation:r.affiliation,value:r.revenue,tax:r.tax,shipping:r.shipping,currency:r.currency,coupon:r.coupon,items:o.map(function(t){return{item_id:t.product_id,item_name:t.name,sku:t.sku,currency:t.currency,item_category:t.category,price:t.price,quantity:t.quantity,total:t.total}}),customer:window.customerHashed}),window.purchaseEvent&&"function"==typeof window.purchaseEvent&&window.purchaseEvent(i),window.ttq&&"function"==typeof window.ttq.track&&window.ttq.track("Purchase",{value:"string"==typeof t.order_total?parseFloat(t.order_total):t.order_total,currency:n,content_type:"product",contents:o.map(function(t){return t.content_id=t.product_id,t.content_type="product",t})}),window.conversionEvents&&window.conversionEvents.purchase&&"function"==typeof window.conversionEvents.purchase&&window.conversionEvents.purchase({eventId:t.id,order:t,customer:window.customerHashed,currency:n})}catch(t){console.log("error track purchase")}}